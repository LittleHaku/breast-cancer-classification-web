{% extends 'base.html' %}

{% load static %}

{% block title %}Classifier Detail{% endblock %}

{% block content %}
<div class="classifier">
  <h2>{{ classifier.name }}</h2>
  <p><strong>Ensemble:</strong> {{ classifier.ensemble|yesno:"Yes,No" }}</p>
  <p>{{ classifier.short_description }}</p>
  <h3>Hyperparameters</h3>
  <p>Hyperparameters are the parameters that are not learned by the model, they are set before the training process, to
    optimize the model, you can change these parameters to see how the model behaves.</p>
  <div class="hyperparameters">
    <details>
      <summary>Click here to see hyperparameters</summary>
      {% for key, value in classifier.hyperparameters.items %}
      <div class="hyperparameter">
        <strong>{{ key }}:</strong>
        {% if key == "estimators" %}
        {% for estimator in value %}
        {% for name, params in estimator.items %}
        <div class="estimator">
          <h4>{{ name }}</h4>
          {% for param_key, param_value in params.items %}
          <div class="param">
            <strong>{{ param_key }}:</strong> {{ param_value }}
          </div>
          {% endfor %}
        </div>
        {% endfor %}
        {% endfor %}
        {% else %}
        {{ value }}
        {% endif %}
      </div>
      {% endfor %}
    </details>
  </div>
  <h3>Metrics</h3>
  <p>Metrics let us see how well the model is performing, the confusion matrix shows us how many samples were classified
    correctly and how many were classified incorrectly.</p>
  <details>
    <summary>Click here to see metrics and confusion matrix</summary>
    {% for metric in metrics %}
    <div class="metric">
      <strong>F1 Score:</strong> {{ metric.f1_score }}<br>
      <strong>Recall:</strong> {{ metric.recall }}<br>
      <strong>F2 Score:</strong> {{ metric.f2_score }}<br>
      <strong>Balanced Accuracy:</strong> {{ metric.balanced_accuracy }}<br>
      <img src="{% static metric.confusion_matrix %}" alt="Confusion Matrix" style="max-width: 800px; height: auto;">
    </div>
  </details>
  <h3>Feature Importance</h3>
  <details>
    <summary>Click here to see global features importance</summary>
    <p>In both plots the features are ranked by importance, with the most important feature at the top.</p>
    <p>The second one, the beeswarm plot, shows the distribution of feature importance for each feature, each dot
      represents a sample, the color represents if the value was high or low, and then if it is to the left or right of
      the mean indicates how important that feature was for the decision, the more to the right the more malignant the
      sample was, and the more to the left the more benign it was.</p>
    <div class="plots">
      <div>
        <h4>Bar Plot</h4>
        <img src="{% static metric.global_features_plot %}" alt="Global Features Plot"
          style="max-width: 800px; height: auto;">
      </div>
      <div>
        <h4>Beeswarm Plot</h4>
        <img src="{% static metric.beeswarm_plot %}" alt="Beeswarm Plot" style="max-width: 800px; height: auto;">
      </div>
    </div>
</div>
{% endfor %}
</details>

<h3>Single Feature Analysis</h3>
<p>In these plots we can see in more detail how each of the features affects the result, each dot is again a sample,
  with dots to the right being higher values of that feature, and dots to the left being lower values of that feature,
  the Y axis is the predicted probability of the sample being malignant, the more to the top the more malignant the
  sample was, and the more to the bottom the more benign it was. The red line helps us see the trend of the feature, if
  the line is going up, it means that the feature is positively correlated with the result, that is, the higher the
  value, the more likely the sample is to be malignant, and if the line is going down, it means that the feature is
  negatively correlated with the result. Lastly the color of the dots are related to another feature which is selected
  by the SHAP library, the more pink the higher that feature, the more blue the lower that feature.</p>
{% for feature in features %}
<details>
  <summary>Click here to see {{ feature.name }}</summary>
  <div class="feature">
    <img src="{% static feature.mean_path %}" alt="Mean Plot" style="max-width: 500px; height: auto;">
    <img src="{% static feature.error_path %}" alt="Error Plot" style="max-width: 500px; height: auto;">
    <img src="{% static feature.worst_path %}" alt="Worst Plot" style="max-width: 500px; height: auto;">
  </div>
</details>
{% endfor %}

<div>
  <h3>Classification Examples/Instances</h3>
  <p>In this section we can see how the classifier made some of its decisions, these are split into benign and
    malignant,
    which are instances were the classifier was the most confident about its decision, closest to the decision boundary,
    which are instances were the classifier was the least confident about its decision, and misclassified, which are
    instances that were classified incorrectly.</p>
  <p>These plots are called waterfall plots, the f(x) means the predicted probability of the sample being malignant. The
    features are sorted by importance, with the most important feature at the top, and the least important feature at
    the
    bottom. The red arrow to the right means that the feature contributed to a malignant decision, and the blue arrow to
    the left means that the feature contributed to a benign decision, also the higher the value in the arrow, the more
    the
    feature contributed to the decision.</p>

  <h4>Benign</h4>
  <details>
    <summary>Click here to see benign examples</summary>
    {% for instance in benign_instances %}
    <div class="instance">
      <img src="{% static instance.path %}" alt="Instance" style="max-width: 800px; height: auto;">
    </div>
    {% endfor %}
  </details>

  <h4>Malignant</h4></p>
  <details>
    <summary>Click here to see malignant examples</summary>
    {% for instance in malignant_instances %}
\
    <div class="instance">
      <img src="{% static instance.path %}" alt="Instance" style="max-width: 800px; height: auto;">
    </div>
    {% endfor %}
  </details>

  <h4>Closest to the Decision Boundary</h4>
  <details>
    <summary>Click here to see instances closest to the decision boundary</summary>
    {% for instance in closest_instances %}
    <div class="instance">
      <img src="{% static instance.path %}" alt="Instance" style="max-width: 800px; height: auto;">
    </div>
    {% endfor %}
  </details>

  <h4>Misclassified</h4>
  <details>
    <summary>Click here to see misclassified examples</summary>
    {% for instance in missclassified_instances %}
    <div class="instance">
      <img src="{% static instance.path %}" alt="Instance" style="max-width: 800px; height: auto;">
    </div>
    {% endfor %}
  </details>
</div>

{% endblock %}